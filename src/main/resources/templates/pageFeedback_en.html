<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{wide}" lang="en">
<th:block layout:fragment="content">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <style>
        th {
            font-size: 12px;
        }
        
        td {
            font-size: 12px;
        }
        
        .hidden {
            display: none;
        }
        
        .container .content {
            display: none;
            padding: 5px;
        }
        
        .table.dataTable {
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-size: 12px;
        }
        
        .dataTables_filter input {
            height: 35px;
            width: 150px;
        }
        
        .dataTables_filter {
            font-size: 15px;
        }
        
        .dataTables_length {
            font-size: 12px;
        }
        
        .dataTables_info {
            font-size: 12px;
        }
        
        .dataTables_paginate {
            font-size: 12px;
        }
        
        .dt-button {
            text-align: center;
            font-size: 12px;
        }
        
        #rangeSelection {
            margin-left: 1rem;
        }
        
        .fa {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>



    <div class="container">
        <h1>Page feedback tool</h1>
        <h4 class="wb-inv">Filtering options</h4>

        <form class="wb-tables-filter" data-bind-to="problemTable">
            <div class="row">
                <div class="col-sm-6">
                    <h4 class="h4">Filter options</h4>
                    <p class="mrgn-tp-md">Use these filters to get page feedback</p>
                </div>
                <div class="col-sm-6">
                    <h4 class="h4">Feedback admin</h4>
                    <p class="mrgn-tp-md">Use these filters to get a list of pages using the feedback tool</p>
                </div>
            </div>


            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label for="Department">Department</label>
                        <select class="form-control" id="Department" name="Department" data-column="5">
                            <option value="">All</option>
                            <option value="CRA">Canada Revenue Agency</option>
                            <option value="ECCC">Environment and Climate Change Canada</option>
                            <option value="DFO">Department of Fisheries and Oceans</option>
                            <option value="Employment and Social Development Canada">Employment and Social Development Canada</option>
                            <option value="FCAC">Financial Consumer Agency of Canada</option>
                            <option value="FIN">Department of Finance</option>
                            <option value="IRCC">Immigration, Refugees and Citizenship Canada</option>
                            <option value="CCG">Canadian Coast Guard</option>
                            <option value="Health Canada">Health Canada</option>
                            <option value="ISED">Innovation, Science and Economic Development Canada</option>
                            <option value="ISC">Indigenous Services Canada</option>
                            <option value="NRC">National Research Council</option>
                            <option value="Public Health Agency of Canada">Public Health Agency of Canada</option>
                            <option value="PSPC">Public Services and Procurement Canada</option>
                            <option value="TBS">Treasury Board of Canada Secretariat</option>
                            <option value="SC">Service Canada</option>
                            <option value="DND">Department of National Defence</option>
                            <option value="OMBDNDCAF">OMBDNDCAF</option>
                            <!-- DEPARTMENTS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="section">Section</label>
                        <select class="form-control" id="section" name="section" data-column="6">
                            <option value="">All</option>
                            <option value="travel-wizard">travel-wizard</option>
                            <option value="COVID">COVID</option>
                            <option value="CRB">CRB</option>
                            <option value="Vaccines">Vaccines</option>
                            <option value="PTR">PTR</option>
                            <option value="COVID Alert">COVID Alert</option>
                            <option value="CRSB">CRSB</option>
                            <option value="CEWS">CEWS</option>
                            <option value="CERS">CERS</option>
                            <option value="Business">Business</option>
                            <option value="WFHE">WFHE</option>
                            <option value="ITB">ITB</option>
                            <option value="ECM">ECM</option>
                            <option value="Health">Health</option>
                            <option value="Pay">Pay</option>
                            <option value="CIG">CIG</option>
                            <option value="Sign in">Sign in</option>
                            <option value="Canada's Parliamentary Precinct">Canada's Parliamentary Precinct</option>
                            <option value="PIT">PIT</option>
                            <option value="GST/HST">GST/HST</option>
                            <option value="CERB">CERB</option>
                            <option value="Design system">Design system</option>
                            <option value="Retirement planning">Retirement planning</option>
                            <option value="Skills for Success">Skills for Success</option>
                            <option value="COVID-19 data trends">COVID-19 data trends</option>
                            <option value="Social Development Partnerships Program">Social Development Partnerships
                                Program</option>
                            <option value="OBJ">OBJ</option>
                            <option value="Mortgages">Mortgages</option>
                            <option value="CEWS-CRHP">CEWS-CRHP</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dt_theme">Theme</label>
                        <select class="form-control" id="dt_theme" name="dt_theme" data-column="7">
                            <option value="">All</option>
                            <option value="Business">Business</option>
                            <option value="COVID">COVID</option>
                            <option value="Environment and natural resources">Environment and Natural Resources</option>
                            <option value="Health">Health</option>
                            <option value="Money and finances">Money and Finances</option>
                            <option value="Public Service">Public Service</option>
                            <option value="Science and innovation">Science and Innovation</option>
                            <option value="Travel">Travel</option>
                            <option value="Taxes">Taxes</option>
                            <option value="Youth">Youth</option>
                            <option value="Culture, history and sport">Culture, history and sport</option>
                            <option value="Policies">Policies</option>
                            <option value="Top tasks">Top tasks</option>
                            <option value="Jobs">Jobs</option>
                            <option value="Funding">Funding</option>
                            <option value="Employment Insurance">Employment Insurance</option>
                            <option value="Education/Research">Education/Research</option>

                            <!-- THEMES -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="min">Date Range
                            <span class="wb-inv">from start date</span></label>
                        <div class="form-inline">
                            <div class="form-group">
                                <input type="date" class="form-control" id="min" name="min">
                            </div>
                            <label for="max">To
                                <span class="wb-inv">end date</span></label>
                            <div class="form-group">
                                <input type="date" class="form-control" id="max" name="max">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-inline">
                            <label for="rangeSelection">or choose
                            <span class="wb-inv">from start date</span></label>
                            <select class="form-control" id="rangeSelection" name="rangeSelection">
                                    <option value="">Duration</option>
                                    <option value="seven">last 7 days</option>
                                    <option value="fifteen">last 15 days</option>
                                    <option value="thirty">last 30 days</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label for="deptINV">Department</label>
                        <select class="form-control" id="deptINV" name="deptINV" data-column="5">
                            <option value="">Choose a department</option>
                            <option value="CRA">Canada Revenue Agency</option>
                            <option value="DFO">Department of Fisheries and Oceans</option>
                            <option value="Employment and Social Development Canada">Employment and Social Development
                                Canada</option>
                            <option value="FCAC">Financial Consumer Agency of Canada</option>
                            <option value="FIN">Department of Finance</option>
                            <option value="Health Canada">Health Canada</option>
                            <option value="ISED">Innovation, Science and Economic Development Canada</option>
                            <option value="ISC">Indigenous Services Canada</option>
                            <option value="NRC">National Research Council</option>
                            <option value="Public Health Agency of Canada">Public Health Agency of Canada</option>
                            <option value="PSPC">Public Services and Procurement Canada</option>
                            <option value="TBS">Treasury Board of Canada Secretariat</option>
                            <option value="SC">Service Canada</option>
                            <option value="DND">Department of National Defence</option>
                            <!-- DEPARTMENTS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sectionINV">Section</label>
                        <select class="form-control" id="sectionINV" name="sectionINV" data-column="6">
                            <option value="">All</option>
                            <option value="travel-wizard">travel-wizard</option>
                            <option value="COVID">COVID</option>
                            <option value="CRB">CRB</option>
                            <option value="Vaccines">Vaccines</option>
                            <option value="PTR">PTR</option>
                            <option value="COVID Alert">COVID Alert</option>
                            <option value="CRSB">CRSB</option>
                            <option value="CEWS">CEWS</option>
                            <option value="CERS">CERS</option>
                            <option value="Business">Business</option>
                            <option value="Canada's Parliamentary Precinct">Canada's Parliamentary Precinct</option>
                            <option value="WFHE">WFHE</option>
                            <option value="ITB">ITB</option>
                            <option value="ECM">ECM</option>
                            <option value="Health">Health</option>
                            <option value="Pay">Pay</option>
                            <option value="CIG">CIG</option>
                            <option value="Sign in">Sign in</option>
                            <option value="PIT">PIT</option>
                            <option value="GST/HST">GST/HST</option>
                            <option value="CERB">CERB</option>
                            <option value="Design system">Design system</option>
                            <option value="Retirement planning">Retirement planning</option>
                            <option value="Skills for Success">Skills for Success</option>
                            <option value="COVID-19 data trends">COVID-19 data trends</option>
                            <option value="Social Development Partnerships Program">Social Development Partnerships
                                Program</option>
                            <option value="OBJ">OBJ</option>
                            <option value="Mortgages">Mortgages</option>
                            <option value="CEWS-CRHP">CEWS-CRHP</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="themeINV">Theme</label>
                        <select class="form-control" id="themeINV" name="themeINV" data-column="7">
                            <option value="">All</option>
                            <option value="Business">Business</option>
                            <option value="COVID">COVID</option>
                            <option value="Environment and natural resources">Environment and Natural Resources</option>
                            <option value="Health">Health</option>
                            <option value="Money and finances">Money and Finances</option>
                            <option value="Public Service">Public Service</option>
                            <option value="Science and innovation">Science and Innovation</option>
                            <option value="Culture, history and sport">Culture, history and sport</option>
                            <option value="Travel">Travel</option>
                            <option value="Taxes">Taxes</option>
                            <option value="Youth">Youth</option>
                            <!-- THEMES -->
                        </select>
                    </div>
                </div>
            </div>

            <div class="mrgn-lft-sm row">
                <!-- <button type="submit" class="btn btn-primary" aria-controls="problemTable">Filter</button> -->
                <button type="reset" class="btn btn-primary" id="clear-text">Reset to defaults</button>
            </div>
            <br>
        </form>
    </div>

    <div class="col-md-12">
        <div class="table-responsive">
            <table id="problemTable" class="small table hover display compact">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time stamp</th>
                        <th>Comment</th>
                        <th>Problem</th>
                        <th>URL</th>
                        <th>Total comments</th>
                        <th>Page title</th>
                        <th>Language</th>
                        <th>Department</th>
                        <th>Section</th>
                        <th>Theme</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>



</th:block>
<th:block layout:fragment="script">
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/colreorder/1.5.2/js/dataTables.colReorder.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/busy-load@0.1.2/src/index.min.js"></script>
    <script type="text/javascript" src="js/spring-friendly.min.js"></script>


    <script th:inline="javascript">
        $(document).ready(function() {

            function sortSelectOptions(selector, skip_first) {
                var options = (skip_first) ?
                    $(selector + ' option:not(:first)') :
                    $(selector + ' option');
                var arr = options
                    .map(function(_, o) {
                        return {
                            t: $(o).text(),
                            v: o.value,
                            s: $(o).prop('selected')
                        };
                    })
                    .get();
                arr.sort(function(o1, o2) {
                    var t1 = o1
                        .t
                        .toLowerCase(),
                        t2 = o2
                        .t
                        .toLowerCase();
                    return t1 > t2 ?
                        1 :
                        t1 < t2 ?
                        -1 :
                        0;
                });
                options.each(function(i, o) {
                    o.value = arr[i].v;
                    $(o).text(arr[i].t);
                    if (arr[i].s) {
                        $(o)
                            .attr('selected', 'selected')
                            .prop('selected', true);
                    } else {
                        $(o).removeAttr('selected');
                        $(o).prop('selected', false);
                    }
                });
            }
            sortSelectOptions('#Department', true);
            sortSelectOptions('#dt_theme', true);
            sortSelectOptions('#section', true);

            sortSelectOptions('#sectionINV', true);
            sortSelectOptions('#deptINV', true);
            sortSelectOptions('#themeINV', true);


            function newexportaction(e, dt, button, config) {
                var self = this;
                var oldStart = dt
                    .settings()[0]
                    ._iDisplayStart;
                dt.one('preXhr', function(e, s, data) {
                    // Just this once, load all data from the server...
                    data.start = 0;
                    data.length = 2147483647;
                    dt.one('preDraw', function(e, settings) {
                        // Call the original action function
                        if (button[0].className.indexOf('buttons-copy') >= 0) {
                            $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .copyHtml5
                                .action
                                .call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-excel') >= 0) {
                            $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .excelHtml5
                                .available(dt, config) ?
                                $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .excelHtml5
                                .action
                                .call(self, e, dt, button, config) :
                                $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .excelFlash
                                .action
                                .call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-csv') >= 0) {
                            $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .csvHtml5
                                .available(dt, config) ?
                                $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .csvHtml5
                                .action
                                .call(self, e, dt, button, config) :
                                $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .csvFlash
                                .action
                                .call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-pdf') >= 0) {
                            $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .pdfHtml5
                                .available(dt, config) ?
                                $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .pdfHtml5
                                .action
                                .call(self, e, dt, button, config) :
                                $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .pdfFlash
                                .action
                                .call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-print') >= 0) {
                            $
                                .fn
                                .dataTable
                                .ext
                                .buttons
                                .print
                                .action(e, dt, button, config);
                        }
                        dt.one('preXhr', function(e, s, data) {
                            // DataTables thinks the first item displayed is index 0, but we're not drawing that.
                            // Set the property to what it was before exporting.
                            settings._iDisplayStart = oldStart;
                            data.start = oldStart;
                        });
                        // Reload the grid with the original page. Otherwise, API functions like table.cell(this) don't work properly.
                        setTimeout(dt.ajax.reload, 0);
                        // Prevent rendering of the full data to the DOM
                        return false;
                    });
                });
                // Requery the server with the new one-time export settings
                dt
                    .ajax
                    .reload();
            };

            $('#problemTable')
                .find('thead th')
                .append('<span class="sorting-cnt"><span class="sorting-icons"></span></span>')

            var table = $('table#problemTable').DataTable({
                "order": [
                    [0, "desc"]
                ],
                processing: true,
                language: {
                    processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading..n.</span> '
                },
                lengthMenu: false,
                "drawCallback": function(settings) {
                    fetchTotalCommentsCount();
                },
                retrieve: true,
                ajax: '/problemData',
                serverSide: true,
                columns: [{
                    data: 'problemDate',
                    "width": "10%"
                }, {
                    data: 'timeStamp'
                }, {
                    data: 'problemDetails',
                    "width": "30%"
                }, {
                    data: 'problem',
                    "width": "20%"
                }, {
                    data: 'url',
                    "width": "30%"
                }, {
                    data: 'urlEntries',
                    "width": "10%"
                }, {
                    data: 'title',
                    "width": "50%"
                }, {
                    data: 'language',
                    "width": "10%"
                }, {
                    data: 'institution',
                    visible: false
                }, {
                    data: 'section',
                    visible: false
                }, {
                    data: 'theme',
                    visible: false
                }],

                orderCellsTop: true,
                fixedHeader: true,
                dom: 'fBr<"table-responsive"t>tip',
                buttons: [{
                    "extend": 'csv',
                    "text": 'Download CSV',
                    className: 'btn btn-default',
                    "action": newexportaction
                }, {
                    "extend": 'excel',
                    "text": "Download Excel",
                    className: 'btn btn-default',
                    "action": newexportaction
                }]
            });

            const COLUMNS = ["Date", "TimeStamp", "Comment", "Problem",
                "Url", "UrlEntries", "Title", "Lang", "Dept", "Section", "Theme"
            ]

            const DateColIndex = 0;
            const TimestampColIndex = 1;
            const CommentColIndex = 2;
            const ProblemColIndex = 3;
            const UrlColIndex = 4;
            const urlEntriesColIndex = 5;
            const TitleColIndex = 6;
            const LangColIndex = 7;
            const DeptColIndex = 8;
            const SectionColIndex = 9;
            const ThemeColIndex = 10;

            function replaceSpecialChars(string) {
                var string = string.replace(/[.?]/g, '\\$&');
                return string;
            }

            function fetchTotalCommentsCount() {
                fetch('/pageFeedback/totalCommentsCount')
                    .then(function(response) {
                        // The API call was successful!
                        return response.text();
                    })
                    .then(function(totalCommentsCount) {
                        // This is the HTML from our response as a text string
                        $('#total_comments').text(String(totalCommentsCount));
                    })
                    .catch(function(err) {
                        // There was an error
                        console.warn('Something went wrong.', err);
                    });
            }

            $('#problemTable thead tr')
                .clone(false)
                .appendTo('#problemTable thead');
            $('#problemTable thead tr:eq(1) th').each(function(i) {
                var title = $(this).text();
                $(this).html('<input type="text" id="searchBox' + COLUMNS[i] + '" placeholder="Search ' + title + '" />');

                $('input', this)
                    .unbind()
                    .bind('keyup change', function(e) {
                        if (e.keyCode == 13 || this.value == "") {
                            table
                                .column(i)
                                .search(replaceSpecialChars(this.value))
                                .draw();
                        }
                    });
            });
            $('#problemTable thead tr:eq(1) th:eq(' + urlEntriesColIndex + ')').attr('id', 'total_comments');



            table.column(urlEntriesColIndex).visible(false);
            table.column(TimestampColIndex).visible(false);
            table.column(TitleColIndex).visible(false);

            $('#searchBoxTimeStamp').closest('th').hide();
            $('#searchBoxUrlEntries').closest('th').hide();
            $('#searchBoxTitle').closest('th').hide();

            var minMaxDateChosen = false;

            function clearText() {
                $("#searchBoxDate").val("");
                $("#searchBoxTimeStamp").val("");
                $("#searchBoxComment").val("");
                $("#searchBoxProblem").val("");
                $("#searchBoxURL").val("");
                $("#searchBoxUrlEntries").val("");
                $("#searchBoxTitle").val("");
                $("#searchBoxLang").val("");

                $('#searchBoxDate').closest('th').show()
                $('#searchBoxComment').closest('th').show()
                $('#searchBoxProblem').closest('th').show()

                $('#searchBoxUrlEntries').closest('th').hide()
                $('#searchBoxTimeStamp').closest('th').hide()
                $('#searchBoxTitle').closest('th').hide()

                $('#total_comments').closest('th').hide()
                $('#total_comments').hide()

                $(".sorting-cnt").removeClass("hidden");

                table
                    .column(CommentColIndex)
                    .visible(true)
                    .column(ProblemColIndex)
                    .visible(true)
                    .column(DateColIndex)
                    .visible(true)
                    .column(urlEntriesColIndex)
                    .visible(false)
                    .column(TimestampColIndex)
                    .visible(false)
                    .column(TitleColIndex)
                    .visible(false)
                    .draw()
            }

            $("#clear-text").click(clearText);

            $('#rangeSelection', this).on('keyup change', function() {
                rangeChosen = false;
                if (this.value == "") {
                    table
                        .column(DateColIndex)
                        .search("")
                        .draw()
                }
                if (this.value != "") {
                    rangeChosen = true;
                    table
                        .column(DateColIndex)
                        .search(this.value)
                        .draw()
                }
                if ($('#Department').val() && rangeChosen) {
                    table
                        .column(ThemeColIndex)
                        .search($('#dt_theme').val())
                        .draw();
                }
                if ($('#Department').val() && rangeChosen) {
                    table
                        .column(DeptColIndex)
                        .search($('#Department').val())
                        .draw();
                }
                if ($('#section').val() && rangeChosen) {
                    table
                        .column(SectionColIndex)
                        .search($('#section').val())
                        .draw()
                }
            })

            $('#min', this).on('keyup change', function() {
                minMaxDateChosen = false;
                if (this.value != "" && $('#max').val() != "") {
                    minMaxDateChosen = true;
                    table
                        .column(DateColIndex)
                        .search(this.value + ":" + $('#max').val())
                        .draw();
                }
                if ($('#dt_theme').val() != "" && minMaxDateChosen) {
                    table
                        .column(ThemeColIndex)
                        .search($('#dt_theme').val())
                        .draw()
                }
                if ($('#Department').val() != "" && minMaxDateChosen) {
                    table
                        .column(DeptColIndex)
                        .search($('#Department').val())
                        .draw()
                }
                if ($('#section').val() != "" && minMaxDateChosen) {
                    table
                        .column(SectionColIndex)
                        .search($('#section').val())
                        .draw()
                }
            });

            $('#max', this).on('keyup change', function() {
                minMaxDateChosen = false;
                if (this.value != "" && $('#min').val() != "") {
                    minMaxDateChosen = true;
                    table
                        .column(DateColIndex)
                        .search($('#min').val() + ":" + this.value)
                        .draw();
                }
                if ($('#dt_theme').val() != "" && minMaxDateChosen) {
                    table
                        .column(ThemeColIndex)
                        .search($('#dt_theme').val())
                        .draw()
                }
                if ($('#Department').val() != "" && minMaxDateChosen) {
                    table
                        .column(DeptColIndex)
                        .search($('#Department').val())
                        .draw()
                }
                if ($('#section').val() != "" && minMaxDateChosen) {
                    table
                        .column(SectionColIndex)
                        .search($('#section').val())
                        .draw()
                }
            });

            // $(".container").click(function() {

            //     $header = $(this);
            //     //getting the next element
            //     $content = $header.next();
            //     //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
            //     $content.slideToggle(500, function() {
            //         //execute this after slideToggle is done
            //         //change text of header based on visibility of content div
            //         $header.text(function() {
            //             //change text based on condition
            //             return $content.is(":visible") ? "Collapse" : "Expand";
            //         });
            //     });

            // });

            $('#dt_theme', this).on('keyup change', function() {
                if (this.value == "") {
                    table
                        .column(ThemeColIndex)
                        .search("")
                        .draw()
                }
                if (this.value != "") {
                    table
                        .column(ThemeColIndex)
                        .search(this.value)
                        .draw()
                }
                if (minMaxDateChosen) {
                    table
                        .column(DateColIndex)
                        .search($('#min').val() + ":" + $('#max').val())
                        .draw();
                }
                if ($('#Department').val()) {
                    table
                        .column(DeptColIndex) //change these to const values
                        .search($('#Department').val())
                        .draw()
                }
                if ($('#section').val()) {
                    table
                        .column(SectionColIndex)
                        .search($('#section').val())
                        .draw()
                }
            });

            $('#Department', this).on('keyup change', function() {
                if (this.value == "") {
                    table
                        .column(DeptColIndex)
                        .search("")
                        .draw()
                }
                if (this.value != "") {
                    table
                        .column(DeptColIndex)
                        .search(this.value)
                        .draw()
                }
                if (minMaxDateChosen) {
                    table
                        .column(DateColIndex)
                        .search($('#min').val() + ":" + $('#max').val())
                        .draw();
                }
                if ($('#dt_theme').val() != "") {
                    table
                        .column(ThemeColIndex)
                        .search($('#dt_theme').val())
                        .draw()
                }
                if ($('#section').val() != "") {
                    table
                        .column(SectionColIndex)
                        .search($('#section').val())
                        .draw()
                }
            });

            $('#section', this).on('keyup change', function() {
                if (this.value == "") {
                    table
                        .column(SectionColIndex)
                        .search("")
                        .draw()
                }
                if (this.value != "") {
                    table
                        .column(SectionColIndex)
                        .search(this.value)
                        .draw()
                }
                if (minMaxDateChosen) {
                    table
                        .column(DateColIndex)
                        .search($('#min').val() + ":" + $('#max').val())
                        .draw();
                }
                if ($('#Department').val() != "") {
                    table
                        .column(DeptColIndex) //change these to const values
                        .search($('#Department').val())
                        .draw()
                }
                if ($('#dt_theme').val() != "") {
                    table
                        .column(ThemeColIndex)
                        .search($('#dt_theme').val())
                        .draw()
                }
            });

            $('#deptINV', this).on('keyup change', function() {
                if (this.value == "") {
                    if ($('#sectionINV').val() != "" || $('#themeINV').val() != "") {
                        table
                            .column(DeptColIndex)
                            .search("")
                            .draw()
                    }
                }
                if (this.value != "") {
                    table
                        .column(DeptColIndex)
                        .search(this.value + " ~")
                        .column(ThemeColIndex)
                        .search($('#themeINV').val() + " ~")
                        .column(SectionColIndex)
                        .search($('#sectionINV').val() + " ~")
                        .column(CommentColIndex)
                        .visible(false)
                        .column(ProblemColIndex)
                        .visible(false)
                        .column(DateColIndex)
                        .visible(false)
                        .column(urlEntriesColIndex)
                        .visible(true)
                        .column(TitleColIndex)
                        .visible(true)
                        .draw()

                    $('#searchBoxDate').closest('th').hide()
                    $('#searchBoxTimeStamp').closest('th').hide()
                    $('#searchBoxComment').closest('th').hide()
                    $('#searchBoxProblem').closest('th').hide()
                    $('#searchBoxUrlEntries').closest('th').show()
                    $('#searchBoxTitle').closest('th').show()

                    $('#total_comments').show()

                    $(".sorting-cnt").addClass("hidden");

                }
                if ($('#sectionINV').val() != "") {
                    table
                        .column(SectionColIndex) //change these to const values
                        .search($('#sectionINV').val() + " ~")
                        .draw()
                }
                if ($('#themeINV').val() != "") {
                    table
                        .column(ThemeColIndex) //change these to const values
                        .search($('#themeINV').val() + " ~")
                        .draw()
                }
            });
            $('#sectionINV', this).on('keyup change', function() {
                if (this.value == "") {
                    table
                        .column(SectionColIndex)
                        .search("")
                        .draw()
                }
                if (this.value != "") {
                    table
                        .column(SectionColIndex)
                        .search(this.value + " ~")
                        .column(ThemeColIndex)
                        .search($('#themeINV').val() + " ~")
                        .column(deptINV)
                        .search($('#deptINV').val() + " ~")
                        .column(CommentColIndex)
                        .visible(false)
                        .column(ProblemColIndex)
                        .visible(false)
                        .column(DateColIndex)
                        .visible(false)
                        .column(urlEntriesColIndex)
                        .visible(true)
                        .column(TitleColIndex)
                        .visible(true)
                        .draw()

                    $('#searchBoxDate').closest('th').hide()
                    $('#searchBoxTimeStamp').closest('th').hide()
                    $('#searchBoxComment').closest('th').hide()
                    $('#searchBoxProblem').closest('th').hide()
                    $('#searchBoxUrlEntries').closest('th').show()
                    $('#searchBoxTitle').closest('th').show()

                    $('#total_comments').show()

                    $(".sorting-cnt").addClass("hidden");
                }
                if ($('#deptINV').val() != "") {
                    table
                        .column(DeptColIndex) //change these to const values
                        .search($('#deptINV').val() + " ~")
                        .draw()
                }
                if ($('#themeINV').val() != "") {
                    table
                        .column(ThemeColIndex) //change these to const values
                        .search($('#themeINV').val() + " ~")
                        .draw()
                }
            });
            $('#themeINV', this).on('keyup change', function() {
                if (this.value == "") {
                    table
                        .column(ThemeColIndex)
                        .search("")
                        .draw()
                }
                if (this.value != "") {
                    table
                        .column(ThemeColIndex)
                        .search(this.value + " ~")
                        .column(SectionColIndex)
                        .search($('#sectionINV').val() + " ~")
                        .column(deptINV)
                        .search($('#deptINV').val() + " ~")
                        .column(CommentColIndex)
                        .visible(false)
                        .column(ProblemColIndex)
                        .visible(false)
                        .column(DateColIndex)
                        .visible(false)
                        .column(urlEntriesColIndex)
                        .visible(true)
                        .column(TitleColIndex)
                        .visible(true)
                        .draw()

                    $('#searchBoxDate').closest('th').hide()
                    $('#searchBoxTimeStamp').closest('th').hide()
                    $('#searchBoxComment').closest('th').hide()
                    $('#searchBoxProblem').closest('th').hide()
                    $('#searchBoxUrlEntries').closest('th').show()
                    $('#searchBoxTitle').closest('th').show()

                    $('#total_comments').show()

                    $(".sorting-cnt").addClass("hidden");
                }
                if ($('#deptINV').val() != "") {
                    table
                        .column(DeptColIndex)
                        .search($('#deptINV').val() + " ~")
                        .draw()
                }
                if ($('#sectionINV').val() != "") {
                    table
                        .column(SectionColIndex)
                        .search($('#sectionINV').val() + " ~")
                        .draw()
                }
            });
        });
    </script>

</th:block>

</html>