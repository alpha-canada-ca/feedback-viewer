<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{wide_en}" lang="en">
<th:block layout:fragment="content">
    <link href='https://fonts.googleapis.com/css?family=Open Sans' rel='stylesheet'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <style>
        th {
            font-size: 12px;
        }

        td {
            font-size: 12px;
        }

        .container .content {
            padding: 5px;
        }

        .hidden {
            display: none;
        }

        .table.dataTable {
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-size: 12px;
        }

        .dataTables_filter input {
            height: 35px;
            width: 150px;
        }

        .dataTables_filter {
            font-size: 15px;
        }

        .dataTables_length {
            font-size: 12px;
        }

        .dataTables_info {
            font-size: 12px;
        }

        .dataTables_paginate {
            font-size: 12px;
        }

        .dt-button {
            text-align: center;
            font-size: 12px;
        }

        #rangeSelection {
            margin-left: 1rem;
        }

        .fa {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
    <div class="container">
        <h1>Page feedback tool</h1>
        <details open="true">
            <summary>Filter feedback </summary>
            <h4 class="wb-inv">Filtering options</h4>
            <form class="wb-tables-filter" data-bind-to="problemTable">
                <div class="row">
                    <div class="col-sm-6">
                        <h4 class="h4">Filter options</h4>
                        <p class="mrgn-tp-md">Use these filters to get page feedback</p>
                    </div>
                    <div class="col-sm-6">
                        <h4 class="h4">Feedback admin</h4>
                        <p class="mrgn-tp-md">Use these filters to get a list of pages using the feedback tool</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="institution">Department</label>
                            <select class="form-control" id="institution" name="institution" data-column="10">
                                <option value="">All</option>
                                <option value="CCG">CCG/GCC</option>
                                <option value="CIRNAC">CIRNAC/RCAANC</option>
                                <option value="CRA">CRA/ARC</option>
                                <option value="CSE">CSE/CST</option>
                                <option value="DFO">DFO/MPO</option>
                                <option value="DND">DND/MND</option>
                                <option value="ECCC">ECCC/ECCC</option>
                                <option value="Employment and Social Development Canada">ESDC/EDSC</option>
                                <option value="FCAC">FCAC/ACFC</option>
                                <option value="FIN">FIN/FIN</option>
                                <option value="Global Affairs Canada">GAC/AMC</option>
                                <option value="Health Canada">HC/SC</option>
                                <option value="IRCC">IRCC/IRCC</option>
                                <option value="ISC">ISC/SAC</option>
                                <option value="ISED">ISED/ISDE</option>
                                <option value="LAC">LAC/BAC</option>
                                <option value="NRC">NRC/CNRC</option>
                                <option value="OMBDNDCAF">OMBDNDCAF/OMBMDNFAC</option>
                                <option value="PS">PS/SP</option>
                                <option value="PSPC">PSPC/SPAC</option>
                                <option value="Public Health Agency of Canada">PHAC/ASPC</option>
                                <option value="SC">SC/SC</option>
                                <option value="SST">SST/TSS</option>
                                <option value="TBS">TBS/SCT</option><!-- DEPARTMENTS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="section">Section</label>
                            <select class="form-control" id="section" name="section" data-column="8">
                                <option value="">All</option>
                                <option value="Business">Business</option>
                                <option value="Canada's Parliamentary Precinct">Canada's Parliamentary Precinct</option>
                                <option value="CERB">CERB</option>
                                <option value="CERS">CERS</option>
                                <option value="CEWS-CRHP">CEWS-CRHP</option>
                                <option value="CEWS">CEWS</option>
                                <option value="CIG">CIG</option>
                                <option value="COVID Alert">COVID Alert</option>
                                <option value="COVID-19 data trends">COVID-19 data trends</option>
                                <option value="COVID">COVID</option>
                                <option value="CPP Retirement pension">CPP Retirement pension</option>
                                <option value="CRB">CRB</option>
                                <option value="CRSB">CRSB</option>
                                <option value="Design system">Design system</option>
                                <option value="Disability">Disability</option>
                                <option value="ECM">ECM</option>
                                <option value="Education">Education</option>
                                <option value="Employment Insurance">Employment Insurance</option>
                                <option value="Fiona">Fiona</option>
                                <option value="Firearms">Firearms</option>
                                <option value="GST/HST">GST/HST</option>
                                <option value="Health">Health</option>
                                <option value="Health data">Health data</option>
                                <option value="Help centre">Help centre</option>
                                <option value="Housing">Housing</option>
                                <option value="ITB">ITB</option>
                                <option value="Mortgages">Mortgages</option>
                                <option value="MSCA">MSCA</option>
                                <option value="MSCA-Portal">MSCA-Portal</option>
                                <option value="OBJ">OBJ</option>
                                <option value="Old Age Security">Old Age Security</option>
                                <option value="Passports">Passports</option>
                                <option value="Pay">Pay</option>
                                <option value="PIT">PIT</option>
                                <option value="Policy">Policy</option>
                                <option value="PTR">PTR</option>
                                <option value="R&A">Registration and Authentication</option>
                                <option value="Retirement planning">Retirement planning</option>
                                <option value="Sign in">Sign in</option>
                                <option value="Skills for Success">Skills for Success</option>
                                <option value="Social Development Partnerships Program">Social Development Partnerships
                                <option value="travel-wizard">travel-wizard</option>
                                <option value="Ukraine">Ukraine</option>
                                <option value="Vaccines">Vaccines</option>
                                <option value="WFHE">WFHE</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="theme">Theme</label>
                            <select class="form-control" id="theme" name="theme" data-column="9"><!-- THEMES -->
                                <option value="">All</option>
                                <option value="AboutGov">About Gov</option>
                                <option value="Application status">Application status</option>
                                <option value="Benefits">Benefits</option>
                                <option value="Business">Business</option>
                                <option value="Canada and the world">Canada and the world</option>
                                <option value="COVID">COVID</option>
                                <option value="Culture, history and sport">Culture, history and sport</option>
                                <option value="Defence">Defence</option>
                                <option value="Education/Research">Education/Research</option>
                                <option value="Employment Insurance">Employment Insurance</option>
                                <option value="Environment and natural resources">Environment and Natural Resources
                                </option>
                                <option value="Funding">Funding</option>
                                <option value="Health">Health</option>
                                <option value="Jobs">Jobs</option>
                                <option value="Money and finances">Money and Finances</option>
                                <option value="Policies">Policies</option>
                                <option value="Policing, justice and emergencies">Policing, justice and emergencies
                                </option>
                                <option value="Public Service">Public Service</option>
                                <option value="Science and innovation">Science and Innovation</option>
                                <option value="Taxes">Taxes</option>
                                <option value="Top tasks">Top tasks</option>
                                <option value="Travel">Travel</option>
                                <option value="Youth">Youth</option>
                            </select>
                        </div>
                        <div class="form-group"><label for="min">Date Range <span class="wb-inv">from start
                                    date</span></label>
                            <div class="form-inline">
                                <div class="form-group"><input type="date" class="form-control" id="min" name="min">
                                </div><label for="max">To <span class="wb-inv">end date</span></label>
                                <div class="form-group"><input type="date" class="form-control" id="max" name="max">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-inline">
                                <label for="rangeSelection">or choose <span class="wb-inv">from start
                                        date</span></label>
                                <select class="form-control" id="rangeSelection" name="rangeSelection">
                                    <option value="">Duration</option>
                                    <option value="today">Today</option>
                                    <option value="yesterday">Yesterday</option>
                                    <option value="seven">Last 7 days</option>
                                    <option value="fifteen">Last 15 days</option>
                                    <option value="thirty">Last 30 days</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group"><label for="institutionFA">Department</label>
                            <select class="form-control" id="institutionFA" name="institutionFA" data-column="10">
                                <option value="">All</option>
                                <option value="CCG">CCG/GCC</option>
                                <option value="CIRNAC">CIRNAC/RCAANC</option>
                                <option value="CRA">CRA/ARC</option>
                                <option value="CSE">CSE/CST</option>
                                <option value="DFO">DFO/MPO</option>
                                <option value="DND">DND/MND</option>
                                <option value="ECCC">ECCC/ECCC</option>
                                <option value="Employment and Social Development Canada">ESDC/EDSC</option>
                                <option value="FCAC">FCAC/ACFC</option>
                                <option value="FIN">FIN/FIN</option>
                                <option value="Global Affairs Canada">GAC/AMC</option>
                                <option value="Health Canada">HC/SC</option>
                                <option value="IRCC">IRCC/IRCC</option>
                                <option value="ISC">ISC/SAC</option>
                                <option value="ISED">ISED/ISDE</option>
                                <option value="LAC">LAC/BAC</option>
                                <option value="NRC">NRC/CNRC</option>
                                <option value="OMBDNDCAF">OMBDNDCAF/OMBMDNFAC</option>
                                <option value="PS">PS/SP</option>
                                <option value="PSPC">PSPC/SPAC</option>
                                <option value="Public Health Agency of Canada">PHAC/ASPC</option>
                                <option value="SC">SC/SC</option>
                                <option value="SST">SST/TSS</option>
                                <option value="TBS">TBS/SCT</option><!-- DEPARTMENTS -->
                            </select>
                        </div>
                        <div class="form-group"><label for="sectionFA">Section</label>
                            <select class="form-control" id="sectionFA" name="sectionFA"
                                data-column="8"><!-- SECTIONS -->
                                <option value="">All</option>
                                <option value="Business">Business</option>
                                <option value="Canada's Parliamentary Precinct">Canada's Parliamentary Precinct</option>
                                <option value="CERB">CERB</option>
                                <option value="CERS">CERS</option>
                                <option value="CEWS-CRHP">CEWS-CRHP</option>
                                <option value="CEWS">CEWS</option>
                                <option value="CIG">CIG</option>
                                <option value="COVID Alert">COVID Alert</option>
                                <option value="COVID-19 data trends">COVID-19 data trends</option>
                                <option value="COVID">COVID</option>
                                <option value="CRB">CRB</option>
                                <option value="CRSB">CRSB</option>
                                <option value="Design system">Design system</option>
                                <option value="Disability">Disability</option>
                                <option value="ECM">ECM</option>
                                <option value="Education">Education</option>
                                <option value="Employment Insurance">Employment Insurance</option>
                                <option value="Fiona">Fiona</option>
                                <option value="Firearms">Firearms</option>
                                <option value="GST/HST">GST/HST</option>
                                <option value="Health data">Health data</option>
                                <option value="Health">Health</option>
                                <option value="Help centre">Help centre</option>
                                <option value="Housing">Housing</option>
                                <option value="ITB">ITB</option>
                                <option value="Mortgages">Mortgages</option>
                                <option value="MSCA">MSCA</option>
                                <option value="MSCA-Portal">MSCA-Portal</option>
                                <option value="OBJ">OBJ</option>
                                <option value="Passports">Passports</option>
                                <option value="Pay">Pay</option>
                                <option value="PIT">PIT</option>
                                <option value="Policy">Policy</option>
                                <option value="PTR">PTR</option>
                                <option value="R&A">Registration and Authentication</option>
                                <option value="Retirement planning">Retirement planning</option>
                                <option value="Sign in">Sign in</option>
                                <option value="Skills for Success">Skills for Success</option>
                                <option value="Social Development Partnerships Program">Social Development Partnerships
                                    Program</option>
                                <option value="travel-wizard">travel-wizard</option>
                                <option value="Ukraine">Ukraine</option>
                                <option value="Vaccines">Vaccines</option>
                                <option value="WFHE">WFHE</option>
                            </select>
                        </div>
                        <div class="form-group"><label for="themeFA">Theme</label>
                            <select class="form-control" id="themeFA" name="themeFA" data-column="9">
                                <option value="">All</option>
                                <option value="AboutGov">About Gov</option>
                                <option value="Application status">Application status</option>
                                <option value="Benefits">Benefits</option>
                                <option value="Business">Business</option>
                                <option value="Canada and the world">Canada and the world</option>
                                <option value="COVID">COVID</option>
                                <option value="Culture, history and sport">Culture, history and sport</option>
                                <option value="Defence">Defence</option>
                                <option value="Education/Research">Education/Research</option>
                                <option value="Employment Insurance">Employment Insurance</option>
                                <option value="Environment and natural resources">Environment and Natural Resources
                                </option>
                                <option value="Funding">Funding</option>
                                <option value="Health">Health</option>
                                <option value="Jobs">Jobs</option>
                                <option value="Money and finances">Money and Finances</option>
                                <option value="Policies">Policies</option>
                                <option value="Policing, justice and emergencies">Policing, justice and emergencies
                                </option>
                                <option value="Public Service">Public Service</option>
                                <option value="Science and innovation">Science and Innovation</option>
                                <option value="Taxes">Taxes</option>
                                <option value="Top tasks">Top tasks</option>
                                <option value="Travel">Travel</option>
                                <option value="Youth">Youth</option><!-- THEMES -->
                            </select>
                        </div>
                    </div>
                </div>
                <div class="mrgn-lft-sm row">
                    <!-- <button type="submit" class="btn btn-primary" aria-controls="problemTable">Filter</button>--><button
                        type="reset" class="btn btn-primary" id="reset-to-default">Reset to defaults</button>
                </div><br>
            </form>
        </details>
    </div>
    <div class="col-md-12">
        <div class="table-responsive">
            <table id="problemTable" class="small table hover display compact">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time stamp</th>
                        <th>Comment</th>
                        <th>Problem</th>
                        <th>URL</th>
                        <th>Page title</th>
                        <th>Language</th>
                        <th>Institution</th>
                        <th>Section</th>
                        <th>Theme</th>
                        <th>Total comments</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</th:block>
<th:block layout:fragment="script">
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/colreorder/1.5.2/js/dataTables.colReorder.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/busy-load@0.1.2/src/index.min.js"></script>
    <script type="text/javascript" src="js/spring-friendly.min.js"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            function newexportaction(e, dt, button, config) {
                var self = this;
                var oldStart = dt.settings()[0]._iDisplayStart;
                dt.one('preXhr', function (e, s, data) {
                    // Just this once, load all data from the server...
                    data.start = 0;
                    data.length = 2147483647;
                    dt.one('preDraw', function (e, settings) {
                        if (button[0].className.indexOf('buttons-excel') >= 0) {
                            $.fn.dataTable.ext.buttons.excelHtml5.available(dt, config) ? $.fn.dataTable.ext.buttons.excelHtml5.action.call(self, e, dt, button, config) : $.fn.dataTable.ext.buttons.excelFlash.action.call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-csv') >= 0) {
                            $.fn.dataTable.ext.buttons.csvHtml5.available(dt, config) ? $.fn.dataTable.ext.buttons.csvHtml5.action.call(self, e, dt, button, config) : $.fn.dataTable.ext.buttons.csvFlash.action.call(self, e, dt, button, config);
                        }
                        dt.one('preXhr', function (e, s, data) {
                            // DataTables thinks the first item displayed is index 0, but we're not drawing that.
                            // Set the property to what it was before exporting.
                            settings._iDisplayStart = oldStart;
                            data.start = oldStart;
                        }); // Reload the grid with the original page. Otherwise, API functions like table.cell(this) don't work properly.
                        setTimeout(dt.ajax.reload, 0); // Prevent rendering of the full data to the DOM
                        return false;
                    });
                }); // Requery the server with the new one-time export settings
                dt.ajax.reload();
            };
            const today = new Date().toLocaleDateString('en-CA');
            $('#problemTable').find('thead th').append('<span class="sorting-cnt"><span class="sorting-icons"></span></span>')

            var table = $('#problemTable').DataTable({
                order: [
                    [0, 'desc']
                ],
                processing: true,
                language: {
                    processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span>',
                    infoFiltered: `(filtered from _MAX_ total entries, 2022-10-01 to ${today})`,
                    error: 'Your session has timed out. Refresh the page and sign in again.'
                },
                lengthMenu: false,
                drawCallback: fetchTotalCommentsCount,
                retrieve: true,
                ajax: {
                    url: '/problemData',
                    type: 'GET',
                    error: function (xhr, error, thrown) {
                        alert("Error retrieving data. Please refresh the page and try again.");
                    }
                },
                serverSide: true,
                columns: [{
                    data: 'problemDate',
                    width: '10%'
                }, {
                    data: 'timeStamp'
                }, {
                    data: 'problemDetails',
                    width: '30%'
                }, {
                    data: 'problem',
                    width: '20%'
                }, {
                    data: 'url',
                    width: '30%'
                }, {
                    data: 'title',
                    width: '50%'
                }, {
                    data: 'language',
                    width: '10%'
                }, {
                    data: 'institution',
                    visible: false
                }, {
                    data: 'section',
                    visible: false
                }, {
                    data: 'theme',
                    visible: false
                }, {
                    data: 'urlEntries',
                    width: '10%'
                }],
                orderCellsTop: true,
                fixedHeader: true,
                dom: 'fBr<"table-responsive"t>tip',
                buttons: [{
                    extend: 'csv',
                    text: 'Download CSV',
                    className: 'btn btn-default',
                    action: newexportaction
                }, {
                    extend: 'excel',
                    text: 'Download Excel',
                    className: 'btn btn-default',
                    action: newexportaction
                },],
            });

            const COLUMNS = ["Date", "TimeStamp", "Comment", "Problem", "Url", "Title", "Lang", "Institution", "Section", "Theme", "UrlEntries"]
            const DateColIndex = 0;
            const TimestampColIndex = 1;
            const CommentColIndex = 2;
            const ProblemColIndex = 3;
            const UrlColIndex = 4;
            const TitleColIndex = 5;
            const LangColIndex = 6;
            const InstitutionColIndex = 7;
            const SectionColIndex = 8;
            const ThemeColIndex = 9;
            const urlEntriesColIndex = 10;
            var minMaxDateChosen = false;

            function replaceSpecialChars(string) {
                var string = string.replace(/[.?]/g, '\\$&');
                return string;
            }


            // This function fetches the total count of comments for the page using an API call
            function fetchTotalCommentsCount() {
                fetch('/pageFeedback/totalCommentsCount')
                    .then(response => response.text())
                    .then(totalCommentsCount => {
                        $('#total_comments').text(String(totalCommentsCount));
                    })
                    .catch(err => {
                        console.warn('Something went wrong.', err);
                    });
            }

            // This code clones the first row of a table and appends it to the table header
            $('#problemTable thead tr').clone(false).appendTo('#problemTable thead');

            // This code adds a search box to each column of the table header row
            $('#problemTable thead tr:eq(1) th').each(function (i) {
                var title = $(this).text();
                $(this).html('<input type="text" id="searchBox' + COLUMNS[i] + '" placeholder="Search ' + title + '" />');
                $('input', this).unbind().bind('keyup change', function (e) {
                    if (e.keyCode == 13 || this.value == "") {
                        table.column(i).search(replaceSpecialChars(this.value)).draw();
                    }
                });
            });

            // This code sets the ID of the column header for the total comments count to 'total_comments'
            $('#problemTable thead tr:eq(1) th:eq(' + urlEntriesColIndex + ')').attr('id', 'total_comments');

            // The table view is reset to default settings when the page is loaded
            resetTableViewToDefault();
            $("#reset-to-default").click(resetTableViewToDefault);

            // This function initializes the feedback admin view by resetting search boxes and hiding columns
            function initFeedbackAdminView() {
                $('#institution, #theme, #section, #min, #max, #rangeSelection').val("");
                $('#searchBoxDate, #searchBoxComment, #searchBoxProblem, #searchBoxTimeStamp').closest('th').hide();
                $('#searchBoxUrlEntries, #searchBoxTitle').closest('th').show()
                $('#total_comments').show()
                table.columns([CommentColIndex, ProblemColIndex, DateColIndex]).visible(false);
                table.columns([urlEntriesColIndex, TitleColIndex]).visible(true).page.len(-1).draw();
            }

            // This function resets the table view to its default settings
            function resetTableViewToDefault() {
                // Clear the values in all of the search boxes when the 'reset to defaults' button is clicked
                $('#searchBoxDate, #searchBoxTimeStamp, #searchBoxComment, #searchBoxProblem, #searchBoxUrl, #searchBoxUrlEntries, #searchBoxTitle, #searchBoxLang').val('');
                $('#themeFA, #sectionFA, #institutionFA').val('');
                $('#searchBoxDate, #searchBoxComment, #searchBoxProblem').closest('th').show();
                $('#searchBoxUrlEntries, #searchBoxTitle, #searchBoxTimeStamp').closest('th').hide();
                $('#total_comments').hide().closest('th').hide()
                // Reset the search filters and column visibility to their default values
                table.columns([UrlColIndex, LangColIndex, InstitutionColIndex, SectionColIndex, ThemeColIndex]).search("")
                table.columns([CommentColIndex, ProblemColIndex, DateColIndex]).search("").visible(true)
                table.columns([urlEntriesColIndex, TimestampColIndex, TitleColIndex]).search("").visible(false).page.len(10).draw()
            }

            $('#rangeSelection', this).on('keyup change', function () {
                resetTableViewToDefault();

                var rangeValue = this.value.trim();
                var isRangeChosen = rangeValue !== "";

                if (!isRangeChosen) {
                    rangeChosen = false;
                    table.column(DateColIndex).search("").draw();
                } else {
                    rangeChosen = true;
                    table.column(DateColIndex).search(rangeValue).page.len(10).draw();
                }

                if ($('#institution, #section, #theme').filter(function () {
                    return this.value.trim() !== "";
                }).length === 3) {
                    table.columns([ThemeColIndex, InstitutionColIndex, SectionColIndex])
                        .search([$('#theme').val(), $('#institution').val(), $('#section').val()])
                        .draw();
                } else {
                    if ($('#institution').val() && isRangeChosen) {
                        table.column(InstitutionColIndex).search($('#institution').val()).draw();
                    }
                    if ($('#section').val() && isRangeChosen) {
                        table.column(SectionColIndex).search($('#section').val()).draw();
                    }
                    if ($('#theme').val() && isRangeChosen) {
                        table.column(ThemeColIndex).search($('#theme').val()).draw();
                    }
                }
            });
            $('#min', this).on('keyup change', function () {
                resetTableViewToDefault();
                minMaxDateChosen = false;
                if (this.value != "" && $('#max').val() != "") {
                    minMaxDateChosen = true;
                    table.column(DateColIndex).search(this.value + ":" + $('#max').val()).page.len(10).draw();

                }
                if ($('#theme').val() != "" && minMaxDateChosen) {
                    table.column(ThemeColIndex).search($('#theme').val()).draw()
                }
                if ($('#institution').val() != "" && minMaxDateChosen) {
                    table.column(InstitutionColIndex).search($('#institution').val()).draw()
                }
                if ($('#section').val() != "" && minMaxDateChosen) {
                    table.column(SectionColIndex).search($('#section').val()).draw()
                }
            });
            $('#max', this).on('keyup change', function () {
                resetTableViewToDefault();
                minMaxDateChosen = false;
                if (this.value != "" && $('#min').val() != "") {
                    minMaxDateChosen = true;
                    table.column(DateColIndex).search($('#min').val() + ":" + this.value).page.len(10).draw();

                }
                if ($('#theme').val() != "" && minMaxDateChosen) {
                    table.column(ThemeColIndex).search($('#theme').val()).draw()
                }
                if ($('#institution').val() != "" && minMaxDateChosen) {
                    table.column(InstitutionColIndex).search($('#institution').val()).draw()
                }
                if ($('#section').val() != "" && minMaxDateChosen) {
                    table.column(SectionColIndex).search($('#section').val()).draw()
                }
            });
            $('#theme', this).on('keyup change', function () {
                const themeValue = this.value.trim();
                const sectionValue = $('#section').val().trim();
                const institutionValue = $('#institution').val().trim();
                resetTableViewToDefault();
                if (themeValue === "") {
                    table.column(ThemeColIndex).search("").draw()
                }
                if (themeValue !== "") {
                    table.column(ThemeColIndex).search(themeValue).page.len(10).draw()

                }
                if (minMaxDateChosen) {
                    table.column(DateColIndex).search($('#min').val() + ":" + $('#max').val()).draw();
                }
                if (institutionValue) {
                    table.column(InstitutionColIndex).search(institutionValue).draw()
                }
                if (sectionValue) {
                    table.column(SectionColIndex).search(sectionValue).draw()
                }
            });
            $('#institution', this).on('keyup change', function () {
                const institutionValue = this.value.trim();
                const sectionValue = $('#section').val().trim();
                const themeValue = $('#theme').val().trim();
                resetTableViewToDefault();
                if (institutionValue === "") {
                    table.column(InstitutionColIndex).search("").draw()
                }
                if (institutionValue !== "") {
                    table.column(InstitutionColIndex).search(institutionValue).page.len(10).draw()
                }
                if (minMaxDateChosen) {
                    table.column(DateColIndex).search($('#min').val() + ":" + $('#max').val()).draw();
                }
                if (themeValue !== "") {
                    table.column(ThemeColIndex).search(themeValue).draw()
                }
                if (sectionValue !== "") {
                    table.column(SectionColIndex).search(sectionValue).draw()
                }
            });
            $('#section', this).on('keyup change', function () {
                const sectionValue = this.value.trim();
                const themeValue = $('#theme').val().trim();
                const institutionValue = $('#institution').val().trim();
                resetTableViewToDefault();
                if (sectionValue === "") {
                    table.column(SectionColIndex).search("").draw()
                }
                if (sectionValue !== "") {
                    table.column(SectionColIndex).search(this.value).page.len(10).draw()

                }
                if (minMaxDateChosen) {
                    table.column(DateColIndex).search($('#min').val() + ":" + $('#max').val()).draw();
                }
                if (institutionValue !== "") {
                    table.column(InstitutionColIndex).search(institutionValue).draw()
                }
                if (themeValue !== "") {
                    table.column(ThemeColIndex).search(themeValue).draw()
                }
            });
            $('#institutionFA', this).on('keyup change', function () {
                const institutionValue = this.value.trim();
                const sectionValue = $('#sectionFA').val().trim();
                const themeValue = $('#themeFA').val().trim();
                if (institutionValue === "") {
                    table.column(InstitutionColIndex).search("").draw()
                }
                if (institutionValue !== "") {
                    table.column(InstitutionColIndex).search(institutionValue + " ~").column(ThemeColIndex).search(themeValue + " ~").column(SectionColIndex).search(sectionValue + " ~")
                    initFeedbackAdminView();
                }
                if (sectionValue !== "") {
                    table.column(SectionColIndex).search(sectionValue + " ~").draw()
                }
                if ($('#themeFA').val() != "") {
                    table.column(ThemeColIndex).search(themeValue + " ~").draw()
                }
            });
            $('#sectionFA', this).on('keyup change', function () {
                const sectionValue = this.value.trim();
                const themeValue = $('#themeFA').val().trim();
                const institutionValue = $('#institutionFA').val().trim();
                if (sectionValue === "") {
                    table.column(SectionColIndex).search("").draw()
                }
                if (sectionValue !== "") {
                    table.column(SectionColIndex).search(sectionValue + " ~").column(ThemeColIndex).search(themeValue + " ~").column(institutionFA).search(institutionValue + " ~")
                    initFeedbackAdminView();
                }
                if (institutionValue !== "") {
                    table.column(InstitutionColIndex).search(institutionValue + " ~").draw()
                }
                if (themeValue !== "") {
                    table.column(ThemeColIndex).search(themeValue + " ~").draw()
                }
            });

            $('#themeFA', this).on('keyup change', function () {
                const themeValue = this.value.trim();
                const sectionValue = $('#sectionFA').val().trim();
                const institutionValue = $('#institutionFA').val().trim();
                if (themeValue === "") {
                    table.column(ThemeColIndex).search("").draw()
                }
                if (themeValue !== "") {
                    table.column(ThemeColIndex).search(themeValue + " ~").column(SectionColIndex).search(sectionValue + " ~").column(institutionFA).search(institutionValue + " ~")
                    initFeedbackAdminView();
                }
                if (institutionValue !== "") {
                    table.column(InstitutionColIndex).search(institutionValue + " ~").draw()
                }
                if (sectionValue !== "") {
                    table.column(SectionColIndex).search(sectionValue + " ~").draw()
                }
            });


        }

        );
    </script>
</th:block>

</html>